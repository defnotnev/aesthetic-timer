<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ðŸŽ€ Nevaeh's Ultimate Timer & To-Do Widget</title>

<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg);
    color: var(--text);
    transition: background-color 0.3s, color 0.3s;
  }
  :root {
    --text: #FCF1F6;
    --title: #AD1A72;
    --bg: #fef0f4;
    --container-bg: rgba(255 255 255 / 0.2);
    --blur: 10px;
    --border: rgba(173, 26, 114, 0.4);
    --num-color: #AD1A72;
    --accent: #AD1A72;
    --input-bg: rgba(255 255 255 / 0.3);
    --input-border: rgba(173, 26, 114, 0.5);
    --button-bg: #ffbfd9;
    --button-hover: #e0599e;
    --todo-heart-outline: #AD1A72;
    --todo-star-outline: #AD1A72;
    --todo-heart-fill: #FF69B4;
    --todo-star-fill: #FF69B4;
  }
  body.dark {
    --text: #FCF1F6;
    --title: #FFB7D1;
    --bg: #1e1e2f;
    --container-bg: rgba(30, 30, 47, 0.5);
    --blur: 10px;
    --border: rgba(255, 183, 209, 0.4);
    --num-color: #FFB7D1;
    --accent: #FFB7D1;
    --input-bg: rgba(255, 183, 209, 0.2);
    --input-border: rgba(255, 183, 209, 0.5);
    --button-bg: #ff88c8;
    --button-hover: #ff59b2;
    --todo-heart-outline: #FFB7D1;
    --todo-star-outline: #FFB7D1;
    --todo-heart-fill: #FF69B4;
    --todo-star-fill: #FF69B4;
  }

  /* Container */
  .container {
    max-width: 600px;
    margin: 3rem auto 5rem;
    background: var(--container-bg);
    backdrop-filter: blur(var(--blur));
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1rem 1.5rem 2rem;
  }

  /* Title */
  h1 {
    color: var(--title);
    text-align: center;
    margin-bottom: 1rem;
    user-select: none;
  }

  /* Tabs */
  .tabs {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 1rem;
    user-select: none;
  }
  .tab {
    cursor: pointer;
    padding: 8px 14px;
    border-radius: 9999px;
    font-weight: 600;
    color: var(--accent);
    background: transparent;
    border: 2px solid var(--accent);
    transition: background-color 0.25s, color 0.25s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .tab.active {
    background-color: var(--accent);
    color: var(--container-bg);
    font-weight: 700;
  }
  .tab:hover {
    background-color: var(--button-bg);
  }

  /* Content panels */
  .tab-content {
    display: none;
    animation: fadeIn 0.5s ease forwards;
  }
  .tab-content.active {
    display: block;
  }

  /* Animations */
  @keyframes fadeIn {
    from {opacity: 0;}
    to {opacity: 1;}
  }

  /* Countdown and Timer styles */
  .timer-display {
    font-size: 2.5rem;
    color: var(--num-color);
    text-align: center;
    margin-bottom: 1rem;
    user-select: none;
    font-weight: 600;
  }
  .timer-title {
    text-align: center;
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    font-weight: 700;
    color: var(--title);
    user-select: none;
  }

  /* Input style */
  input[type="text"], input[type="datetime-local"], input[type="number"], input[type="file"] {
    width: 100%;
    padding: 0.5rem 0.75rem;
    font-size: 1rem;
    border: 1.5px solid var(--input-border);
    border-radius: 10px;
    margin-bottom: 1rem;
    background: var(--input-bg);
    color: var(--text);
    outline-offset: 2px;
    outline-color: var(--accent);
  }

  /* Buttons */
  button {
    background-color: var(--button-bg);
    color: var(--container-bg);
    border: none;
    border-radius: 9999px;
    padding: 0.5rem 1rem;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.25s;
    user-select: none;
  }
  button:hover {
    background-color: var(--button-hover);
  }
  button:disabled {
    background-color: var(--input-border);
    cursor: not-allowed;
  }

  /* Flex center */
  .flex-center {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.6rem;
  }

  /* Study timer and stopwatch controls */
  .controls {
    text-align: center;
    margin-bottom: 1rem;
  }

  /* Punches list */
  .punches-list {
    max-height: 120px;
    overflow-y: auto;
    border: 1px solid var(--input-border);
    border-radius: 12px;
    padding: 0.5rem;
    background: var(--input-bg);
    margin-top: 0.5rem;
  }
  .punch-item {
    font-size: 0.9rem;
    color: var(--text);
    border-bottom: 1px dotted var(--border);
    padding: 2px 0;
    user-select: none;
  }

  /* To-do list styles */
  .todo-list {
    list-style: none;
    padding-left: 0;
    max-height: 350px;
    overflow-y: auto;
  }
  .todo-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 6px 10px;
    border-radius: 10px;
    user-select: none;
    background: transparent;
    border: 1px solid transparent;
    transition: background-color 0.3s;
  }
  .todo-item.dragging {
    opacity: 0.5;
  }
  .todo-item:hover {
    background-color: var(--input-bg);
  }
  .todo-text {
    flex-grow: 1;
    cursor: text;
    outline: none;
  }
  .todo-text.completed {
    text-decoration: line-through;
    opacity: 0.6;
  }

  /* Bullets */
  .bullet {
    cursor: pointer;
    font-size: 1.3rem;
    user-select: none;
  }
  .bullet.heart-outline {
    color: var(--todo-heart-outline);
  }
  .bullet.heart-fill {
    color: var(--todo-heart-fill);
  }
  .bullet.star-outline {
    color: var(--todo-star-outline);
  }
  .bullet.star-fill {
    color: var(--todo-star-fill);
  }

  /* Close button */
  .close-btn {
    cursor: pointer;
    font-size: 1.2rem;
    color: var(--accent);
    padding-left: 0.3rem;
    user-select: none;
    transition: color 0.25s;
  }
  .close-btn:hover {
    color: var(--button-hover);
  }

  /* Due date */
  .due-date {
    font-size: 0.75rem;
    color: var(--accent);
    margin-left: 0.5rem;
    user-select: none;
    cursor: pointer;
    border-radius: 5px;
    padding: 0 4px;
  }
  .due-date.placeholder {
    opacity: 0.2;
  }
  .due-date:hover {
    opacity: 1;
    background: var(--input-bg);
  }

  /* Transparent frosted box for timers and todos */
  .frosted-box {
    background: var(--container-bg);
    border-radius: 12px;
    padding: 1rem 1.5rem;
    border: 1px solid var(--border);
    backdrop-filter: blur(var(--blur));
    margin-bottom: 1.5rem;
  }

  /* File upload label */
  .file-upload-label {
    display: block;
    margin-bottom: 1rem;
    font-weight: 600;
    color: var(--accent);
    cursor: pointer;
    user-select: none;
  }
  .file-upload-label:hover {
    text-decoration: underline;
  }
  input[type="file"] {
    display: none;
  }

  /* Theme toggle button */
  .theme-toggle {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: var(--container-bg);
    border: 1.5px solid var(--border);
    border-radius: 9999px;
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    color: var(--accent);
    font-size: 1.5rem;
    user-select: none;
    transition: background-color 0.3s;
  }
  .theme-toggle:hover {
    background: var(--button-bg);
    color: var(--container-bg);
  }

  /* Scrollbar for todos and punches */
  ::-webkit-scrollbar {
    width: 6px;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background-color: var(--accent);
    border-radius: 3px;
  }

  /* Responsive */
  @media (max-width: 640px) {
    .container {
      margin: 2rem 1rem 3rem;
      padding: 1rem;
    }
    .timer-display {
      font-size: 2rem;
    }
  }
</style>
</head>
<body>

<button class="theme-toggle" aria-label="Toggle theme" title="Toggle light/dark mode"><i class="fas fa-sun"></i></button>

<div class="container">
  <h1>ðŸŽ€ Nevaeh's Ultimate Timer & To-Do ðŸŽ€</h1>

  <div class="tabs" role="tablist" aria-label="Main tabs">
    <div class="tab active" role="tab" aria-selected="true" tabindex="0" data-tab="countdowns">
      <i class="fas fa-hourglass-half"></i> Countdowns
    </div>
    <div class="tab" role="tab" tabindex="-1" data-tab="timers">
      <i class="fas fa-stopwatch"></i> Timers
    </div>
    <div class="tab" role="tab" tabindex="-1" data-tab="stopwatch">
      <i class="fas fa-clock"></i> Stopwatch
    </div>
    <div class="tab" role="tab" tabindex="-1" data-tab="pomodoro">
      <i class="fas fa-bell"></i> Pomodoro
    </div>
    <div class="tab" role="tab" tabindex="-1" data-tab="todo">
      <i class="fas fa-list"></i> To-Do List
    </div>
  </div>

  <!-- COUNTDOWNS TAB -->
  <section id="countdowns" class="tab-content active" role="tabpanel">
    <div class="frosted-box">
      <div class="timer-title">Add Countdown (type title then date and press Enter)</div>
      <input id="cd-title" type="text" placeholder="Countdown title..." aria-label="Countdown title" />
      <input id="cd-date" type="datetime-local" aria-label="Countdown date" />
      <button id="add-countdown" disabled>Add</button>

      <ul id="countdown-list" class="todo-list" aria-live="polite" aria-label="Countdown list"></ul>
    </div>
  </section>

  <!-- TIMERS TAB -->
  <section id="timers" class="tab-content" role="tabpanel">
    <div class="frosted-box">
      <div class="timer-title">Add Timer (seconds)</div>
      <input id="timer-seconds" type="number" min="1" placeholder="Seconds..." aria-label="Timer duration in seconds" />
      <button id="add-timer" disabled>Add</button>

      <ul id="timer-list" class="todo-list" aria-live="polite" aria-label="Timers list"></ul>
    </div>
  </section>

  <!-- STOPWATCH TAB -->
  <section id="stopwatch" class="tab-content" role="tabpanel">
    <div class="frosted-box">
      <div class="timer-title">Stopwatch</div>
      <div id="stopwatch-display" class="timer-display">00:00:00</div>
      <div class="controls">
        <button id="sw-start"><i class="fas fa-play"></i> Start</button>
        <button id="sw-stop" disabled><i class="fas fa-pause"></i> Stop</button>
        <button id="sw-reset" disabled><i class="fas fa-redo"></i> Reset</button>
        <button id="sw-punch" disabled><i class="fas fa-thumbtack"></i> Punch</button>
      </div>
      <div class="punches-list" id="punches-list" aria-live="polite" aria-label="Punches list"></div>
    </div>
  </section>

  <!-- POMODORO TAB -->
  <section id="pomodoro" class="tab-content" role="tabpanel">
    <div class="frosted-box">
      <div class="timer-title">Pomodoro Timer</div>
      <div id="pomodoro-display" class="timer-display">25:00</div>
      <div class="controls">
        <button id="pomodoro-start"><i class="fas fa-play"></i> Start</button>
        <button id="pomodoro-stop" disabled><i class="fas fa-pause"></i> Stop</button>
        <button id="pomodoro-reset" disabled><i class="fas fa-redo"></i> Reset</button>
      </div>
    </div>
  </section>

  <!-- TODO LIST TAB -->
  <section id="todo" class="tab-content" role="tabpanel">
    <div class="frosted-box">
      <input id="todo-input" type="text" placeholder="Type task and press Enter (Tab to toggle subtask)" aria-label="Add task input" />
      <button id="todo-reset" title="Clear all tasks">Reset To-Do List</button>
      <ul id="todo-list" class="todo-list" aria-live="polite" aria-label="To-do list"></ul>
    </div>
  </section>

</div>

<audio id="alarm-sound" preload="auto" src="https://cdn.pixabay.com/download/audio/2021/09/27/audio_f1b9b2.mp3"></audio>

<script>
  // THEME TOGGLE
  const themeToggleBtn = document.querySelector('.theme-toggle');
  const sunIcon = '<i class="fas fa-sun"></i>';
  const moonIcon = '<i class="fas fa-moon"></i>';
  const body = document.body;

  // Initialize theme from localStorage or default to light
  function setTheme(dark) {
    if (dark) {
      body.classList.add('dark');
      themeToggleBtn.innerHTML = sunIcon;
      localStorage.setItem('theme', 'dark');
    } else {
      body.classList.remove('dark');
      themeToggleBtn.innerHTML = moonIcon;
      localStorage.setItem('theme', 'light');
    }
  }

  themeToggleBtn.addEventListener('click', () => {
    setTheme(!body.classList.contains('dark'));
  });

  // On load
  setTheme(localStorage.getItem('theme') === 'dark');

  // TAB SWITCHING LOGIC
  const tabs = document.querySelectorAll('.tab');
  const tabContents = document.querySelectorAll('.tab-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => {
        t.classList.remove('active');
        t.setAttribute('aria-selected', 'false');
        t.tabIndex = -1;
      });
      tab.classList.add('active');
      tab.setAttribute('aria-selected', 'true');
      tab.tabIndex = 0;

      const target = tab.getAttribute('data-tab');
      tabContents.forEach(tc => {
        tc.classList.toggle('active', tc.id === target);
      });
    });
  });

  // COUNTDOWNS (multiple)
  const countdownList = document.getElementById('countdown-list');
  const cdTitleInput = document.getElementById('cd-title');
  const cdDateInput = document.getElementById('cd-date');
  const addCountdownBtn = document.getElementById('add-countdown');

  let countdowns = JSON.parse(localStorage.getItem('countdowns')) || [];

  function saveCountdowns() {
    localStorage.setItem('countdowns', JSON.stringify(countdowns));
  }

  function renderCountdowns() {
    countdownList.innerHTML = '';
    countdowns.forEach((cd, i) => {
      const li = document.createElement('li');
      li.className = 'todo-item';
      li.setAttribute('draggable', true);
      li.dataset.index = i;

      const titleSpan = document.createElement('span');
      titleSpan.textContent = cd.title + ' - ';
      titleSpan.style.fontWeight = '700';
      titleSpan.style.color = 'var(--title)';

      const timeSpan = document.createElement('span');
      timeSpan.style.color = 'var(--num-color)';
      timeSpan.style.fontWeight = '600';

      function updateTime() {
        const now = new Date();
        const target = new Date(cd.date);
        const diff = target - now;
        if (diff <= 0) {
          timeSpan.textContent = 'ðŸŽ‰ Done!';
          return;
        }
        const d = Math.floor(diff / (1000*60*60*24));
        const h = Math.floor((diff / (1000*60*60)) % 24);
        const m = Math.floor((diff / (1000*60)) % 60);
        const s = Math.floor((diff / 1000) % 60);
        timeSpan.textContent = `${d}d ${h}h ${m}m ${s}s`;
      }
      updateTime();
      setInterval(updateTime, 1000);

      const removeBtn = document.createElement('span');
      removeBtn.className = 'close-btn';
      removeBtn.innerHTML = '&times;';
      removeBtn.title = 'Remove countdown';
      removeBtn.addEventListener('click', () => {
        countdowns.splice(i, 1);
        saveCountdowns();
        renderCountdowns();
      });

      li.appendChild(titleSpan);
      li.appendChild(timeSpan);
      li.appendChild(removeBtn);
      countdownList.appendChild(li);

      // Drag & drop reorder handlers
      li.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', i);
        li.classList.add('dragging');
      });
      li.addEventListener('dragend', e => {
        li.classList.remove('dragging');
      });
      li.addEventListener('dragover', e => {
        e.preventDefault();
        const dragging = document.querySelector('.dragging');
        if (!dragging || dragging === li) return;
        const bounding = li.getBoundingClientRect();
        const offset = e.clientY - bounding.top;
        const parent = li.parentNode;
        if (offset > bounding.height / 2) {
          parent.insertBefore(dragging, li.nextSibling);
        } else {
          parent.insertBefore(dragging, li);
        }
      });
      li.addEventListener('drop', e => {
        e.preventDefault();
        const fromIndex = Number(e.dataTransfer.getData('text/plain'));
        const toIndex = i;
        if (fromIndex === toIndex) return;
        const item = countdowns.splice(fromIndex, 1)[0];
        countdowns.splice(toIndex, 0, item);
        saveCountdowns();
        renderCountdowns();
      });
    });
  }

  cdTitleInput.addEventListener('input', () => {
    addCountdownBtn.disabled = !(cdTitleInput.value.trim() && cdDateInput.value);
  });
  cdDateInput.addEventListener('input', () => {
    addCountdownBtn.disabled = !(cdTitleInput.value.trim() && cdDateInput.value);
  });
  addCountdownBtn.addEventListener('click', () => {
    countdowns.unshift({title: cdTitleInput.value.trim(), date: cdDateInput.value});
    cdTitleInput.value = '';
    cdDateInput.value = '';
    addCountdownBtn.disabled = true;
    saveCountdowns();
    renderCountdowns();
  });

  renderCountdowns();

  // TIMERS (multiple)
  const timerList = document.getElementById('timer-list');
  const timerSecondsInput = document.getElementById('timer-seconds');
  const addTimerBtn = document.getElementById('add-timer');

  let timers = JSON.parse(localStorage.getItem('timers')) || [];

  function saveTimers() {
    localStorage.setItem('timers', JSON.stringify(timers));
  }

  function formatTimeSec(sec) {
    const h = Math.floor(sec / 3600);
    const m = Math.floor((sec % 3600) / 60);
    const s = sec % 60;
    return [
      h > 0 ? String(h).padStart(2,'0') : null,
      String(m).padStart(2,'0'),
      String(s).padStart(2,'0'),
    ].filter(Boolean).join(':');
  }

  function renderTimers() {
    timerList.innerHTML = '';
    timers.forEach((t, i) => {
      const li = document.createElement('li');
      li.className = 'todo-item';
      li.dataset.index = i;

      const titleSpan = document.createElement('span');
      titleSpan.textContent = `Timer - ${formatTimeSec(t.seconds)}`;
      titleSpan.style.fontWeight = '700';
      titleSpan.style.color = 'var(--title)';

      const timeSpan = document.createElement('span');
      timeSpan.style.color = 'var(--num-color)';
      timeSpan.style.fontWeight = '600';
      timeSpan.textContent = formatTimeSec(t.remaining || t.seconds);

      let intervalId;

      function startTimer() {
        if (intervalId) return;
        const endTime = Date.now() + (t.remaining ?? t.seconds) * 1000;
        intervalId = setInterval(() => {
          const diff = Math.round((endTime - Date.now())/1000);
          if (diff <= 0) {
            clearInterval(intervalId);
            intervalId = null;
            timeSpan.textContent = 'â° Done!';
            playAlarm();
            t.remaining = 0;
            saveTimers();
            return;
          }
          t.remaining = diff;
          timeSpan.textContent = formatTimeSec(diff);
        }, 1000);
      }

      function stopTimer() {
        clearInterval(intervalId);
        intervalId = null;
      }

      const startBtn = document.createElement('button');
      startBtn.innerHTML = '<i class="fas fa-play"></i>';
      startBtn.title = 'Start timer';
      startBtn.addEventListener('click', () => {
        startTimer();
      });

      const stopBtn = document.createElement('button');
      stopBtn.innerHTML = '<i class="fas fa-pause"></i>';
      stopBtn.title = 'Stop timer';
      stopBtn.addEventListener('click', () => {
        stopTimer();
        saveTimers();
      });

      const resetBtn = document.createElement('button');
      resetBtn.innerHTML = '<i class="fas fa-redo"></i>';
      resetBtn.title = 'Reset timer';
      resetBtn.addEventListener('click', () => {
        stopTimer();
        t.remaining = t.seconds;
        timeSpan.textContent = formatTimeSec(t.seconds);
        saveTimers();
      });

      const removeBtn = document.createElement('span');
      removeBtn.className = 'close-btn';
      removeBtn.innerHTML = '&times;';
      removeBtn.title = 'Remove timer';
      removeBtn.addEventListener('click', () => {
        timers.splice(i, 1);
        saveTimers();
        renderTimers();
      });

      li.appendChild(titleSpan);
      li.appendChild(timeSpan);
      li.appendChild(startBtn);
      li.appendChild(stopBtn);
      li.appendChild(resetBtn);
      li.appendChild(removeBtn);
      timerList.appendChild(li);
    });
  }

  timerSecondsInput.addEventListener('input', () => {
    addTimerBtn.disabled = !(timerSecondsInput.value && +timerSecondsInput.value > 0);
  });
  addTimerBtn.addEventListener('click', () => {
    timers.unshift({seconds: +timerSecondsInput.value, remaining: +timerSecondsInput.value});
    timerSecondsInput.value = '';
    addTimerBtn.disabled = true;
    saveTimers();
    renderTimers();
  });

  renderTimers();

  // STOPWATCH
  const swDisplay = document.getElementById('stopwatch-display');
  const swStartBtn = document.getElementById('sw-start');
  const swStopBtn = document.getElementById('sw-stop');
  const swResetBtn = document.getElementById('sw-reset');
  const swPunchBtn = document.getElementById('sw-punch');
  const punchesList = document.getElementById('punches-list');

  let swStartTime = 0;
  let swElapsed = 0;
  let swTimerId = null;
  let punches = JSON.parse(localStorage.getItem('sw-punches')) || [];

  function formatTimeMs(ms) {
    const totalSeconds = Math.floor(ms / 1000);
    const h = Math.floor(totalSeconds / 3600);
    const m = Math.floor((totalSeconds % 3600) / 60);
    const s = totalSeconds % 60;
    return [
      h > 0 ? String(h).padStart(2,'0') : '00',
      String(m).padStart(2,'0'),
      String(s).padStart(2,'0'),
    ].join(':');
  }

  function updateSwDisplay() {
    let current = swElapsed;
    if (swStartTime) {
      current += Date.now() - swStartTime;
    }
    swDisplay.textContent = formatTimeMs(current);
  }

  function swTick() {
    updateSwDisplay();
    swTimerId = requestAnimationFrame(swTick);
  }

  function swStart() {
    if (swStartTime) return; // already running
    swStartTime = Date.now();
    swTick();
    swStartBtn.disabled = true;
    swStopBtn.disabled = false;
    swResetBtn.disabled = false;
    swPunchBtn.disabled = false;
  }
  function swStop() {
    if (!swStartTime) return;
    swElapsed += Date.now() - swStartTime;
    swStartTime = 0;
    cancelAnimationFrame(swTimerId);
    swStartBtn.disabled = false;
    swStopBtn.disabled = true;
    swResetBtn.disabled = false;
    swPunchBtn.disabled = true;
  }
  function swReset() {
    swStartTime = 0;
    swElapsed = 0;
    punches = [];
    localStorage.removeItem('sw-punches');
    swDisplay.textContent = '00:00:00';
    punchesList.innerHTML = '';
    swStartBtn.disabled = false;
    swStopBtn.disabled = true;
    swResetBtn.disabled = true;
    swPunchBtn.disabled = true;
  }
  function swPunch() {
    if (!swStartTime) return;
    let current = swElapsed + (Date.now() - swStartTime);
    punches.push(current);
    localStorage.setItem('sw-punches', JSON.stringify(punches));
    renderPunches();
  }
  function renderPunches() {
    punchesList.innerHTML = '';
    punches.forEach((time, i) => {
      const div = document.createElement('div');
      div.className = 'punch-item';
      div.textContent = `Punch ${i + 1}: ${formatTimeMs(time)}`;
      punchesList.appendChild(div);
    });
  }

  swStartBtn.addEventListener('click', swStart);
  swStopBtn.addEventListener('click', swStop);
  swResetBtn.addEventListener('click', swReset);
  swPunchBtn.addEventListener('click', swPunch);

  // Initialize buttons state
  swStartBtn.disabled = false;
  swStopBtn.disabled = true;
  swResetBtn.disabled = true;
  swPunchBtn.disabled = true;

  renderPunches();

  // POMODORO TIMER
  const pomoDisplay = document.getElementById('pomodoro-display');
  const pomoStartBtn = document.getElementById('pomodoro-start');
  const pomoStopBtn = document.getElementById('pomodoro-stop');
  const pomoResetBtn = document.getElementById('pomodoro-reset');

  // Pomodoro default 25/5 (work/rest) minutes
  const POMO_WORK = 25 * 60;
  const POMO_REST = 5 * 60;

  let pomoTimeLeft = POMO_WORK;
  let pomoRunning = false;
  let pomoInterval = null;
  let pomoOnRest = false;

  function updatePomoDisplay() {
    const m = Math.floor(pomoTimeLeft / 60);
    const s = pomoTimeLeft % 60;
    pomoDisplay.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }

  function pomoTick() {
    if (pomoTimeLeft <= 0) {
      playAlarm();
      pomoOnRest = !pomoOnRest;
      pomoTimeLeft = pomoOnRest ? POMO_REST : POMO_WORK;
      updatePomoDisplay();
      return;
    }
    pomoTimeLeft--;
    updatePomoDisplay();
  }

  function pomoStart() {
    if (pomoRunning) return;
    pomoRunning = true;
    pomoInterval = setInterval(pomoTick, 1000);
    pomoStartBtn.disabled = true;
    pomoStopBtn.disabled = false;
    pomoResetBtn.disabled = false;
  }
  function pomoStop() {
    if (!pomoRunning) return;
    pomoRunning = false;
    clearInterval(pomoInterval);
    pomoInterval = null;
    pomoStartBtn.disabled = false;
    pomoStopBtn.disabled = true;
    pomoResetBtn.disabled = false;
  }
  function pomoReset() {
    pomoRunning = false;
    clearInterval(pomoInterval);
    pomoInterval = null;
    pomoOnRest = false;
    pomoTimeLeft = POMO_WORK;
    updatePomoDisplay();
    pomoStartBtn.disabled = false;
    pomoStopBtn.disabled = true;
    pomoResetBtn.disabled = true;
  }

  pomoStartBtn.addEventListener('click', pomoStart);
  pomoStopBtn.addEventListener('click', pomoStop);
  pomoResetBtn.addEventListener('click', pomoReset);

  updatePomoDisplay();

  // TO-DO LIST
  const todoInput = document.getElementById('todo-input');
  const todoList = document.getElementById('todo-list');
  const todoResetBtn = document.getElementById('todo-reset');

  let todos = JSON.parse(localStorage.getItem('todos')) || [];

  function saveTodos() {
    localStorage.setItem('todos', JSON.stringify(todos));
  }

  // Render all tasks and subtasks recursively
  function renderTodos() {
    todoList.innerHTML = '';

    function createTaskItem(task, index, isSubtask = false) {
      const li = document.createElement('li');
      li.className = 'todo-item';
      li.dataset.index = index;
      li.setAttribute('draggable', true);

      const bullet = document.createElement('span');
      bullet.classList.add('bullet');
      bullet.classList.add(isSubtask ? (task.completed ? 'star-fill' : 'star-outline') : (task.completed ? 'heart-fill' : 'heart-outline'));
      bullet.innerHTML = isSubtask ? (task.completed ? '&#9733;' : '&#9734;') : (task.completed ? '&#10084;' : '&#9825;');
      bullet.title = isSubtask ? 'Toggle subtask complete' : 'Toggle task complete';

      bullet.addEventListener('click', () => {
        task.completed = !task.completed;
        saveTodos();
        renderTodos();
      });

      const taskText = document.createElement('div');
      taskText.className = 'todo-text';
      if(task.completed) taskText.classList.add('completed');
      taskText.contentEditable = true;
      taskText.spellcheck = false;
      taskText.textContent = task.text;
      taskText.title = 'Click to edit task';
      taskText.addEventListener('input', () => {
        task.text = taskText.textContent.trim();
        saveTodos();
      });

      // Due date display and editing
      const dueDateSpan = document.createElement('span');
      dueDateSpan.className = 'due-date';
      if (task.due) {
        dueDateSpan.textContent = (new Date(task.due)).toLocaleDateString();
      } else {
        dueDateSpan.textContent = 'Add due date';
        dueDateSpan.classList.add('placeholder');
      }
      dueDateSpan.title = 'Click to set/edit due date';
      dueDateSpan.addEventListener('click', () => {
        const input = document.createElement('input');
        input.type = 'date';
        input.value = task.due ? task.due.split('T')[0] : '';
        input.style.marginLeft = '8px';
        input.onchange = () => {
          if (input.value) {
            task.due = input.value;
          } else {
            delete task.due;
          }
          saveTodos();
          renderTodos();
        };
        dueDateSpan.replaceWith(input);
        input.focus();
        input.onblur = () => renderTodos();
      });

      const removeBtn = document.createElement('span');
      removeBtn.className = 'close-btn';
      removeBtn.innerHTML = '&times;';
      removeBtn.title = 'Remove task';
      removeBtn.addEventListener('click', () => {
        todos.splice(index, 1);
        saveTodos();
        renderTodos();
      });

      li.appendChild(bullet);
      li.appendChild(taskText);
      li.appendChild(dueDateSpan);
      li.appendChild(removeBtn);

      // Drag & drop reorder handlers
      li.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', index);
        li.classList.add('dragging');
      });
      li.addEventListener('dragend', e => {
        li.classList.remove('dragging');
      });
      li.addEventListener('dragover', e => {
        e.preventDefault();
        const dragging = document.querySelector('.dragging');
        if (!dragging || dragging === li) return;
        const bounding = li.getBoundingClientRect();
        const offset = e.clientY - bounding.top;
        const parent = li.parentNode;
        if (offset > bounding.height / 2) {
          parent.insertBefore(dragging, li.nextSibling);
        } else {
          parent.insertBefore(dragging, li);
        }
      });
      li.addEventListener('drop', e => {
        e.preventDefault();
        const fromIndex = Number(e.dataTransfer.getData('text/plain'));
        const toIndex = index;
        if (fromIndex === toIndex) return;
        const item = todos.splice(fromIndex, 1)[0];
        todos.splice(toIndex, 0, item);
        saveTodos();
        renderTodos();
      });

      return li;
    }

    todos.forEach((task, i) => {
      const li = createTaskItem(task, i, false);
      todoList.appendChild(li);
      if (task.subtasks) {
        task.subtasks.forEach((subtask, si) => {
          const subLi = createTaskItem(subtask, i + '-' + si, true);
          subLi.style.marginLeft = '20px';
          todoList.appendChild(subLi);
        });
      }
    });
  }

  // Add new task with minimal UI (Tab toggles between main/subtask)
  let addingSubtask = false;

  todoInput.addEventListener('keydown', e => {
    if (e.key === 'Tab') {
      e.preventDefault();
      addingSubtask = !addingSubtask;
      todoInput.placeholder = addingSubtask ? 'Type subtask and press Enter' : 'Type task and press Enter (Tab to toggle subtask)';
      return;
    }
    if (e.key === 'Enter') {
      e.preventDefault();
      const val = todoInput.value.trim();
      if (!val) return;
      if (!addingSubtask) {
        todos.unshift({ text: val, completed: false });
      } else {
        // Add as subtask to last main task
        let lastMainIndex = -1;
        for(let i=0; i<todos.length; i++){
          if (!todos[i].subtask) lastMainIndex = i;
        }
        if(lastMainIndex === -1){
          // no main task yet, create one
          todos.unshift({ text: val, completed: false });
        } else {
          if (!todos[lastMainIndex].subtasks) todos[lastMainIndex].subtasks = [];
          todos[lastMainIndex].subtasks.unshift({ text: val, completed: false, subtask: true });
        }
      }
      todoInput.value = '';
      saveTodos();
      renderTodos();
    }
  });

  todoResetBtn.addEventListener('click', () => {
    if (confirm('Are you sure you want to clear the entire to-do list?')) {
      todos = [];
      saveTodos();
      renderTodos();
    }
  });

  renderTodos();

  // ALARM SOUND - light and cute by default, can be overridden by user
  const alarmSound = document.getElementById('alarm-sound');

  function playAlarm() {
    alarmSound.play().catch(() => {});
  }

  // END OF SCRIPT
</script>

</body>
</html>
