<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Custom Timer Widget</title>
<style>
  /* BASE STYLES & VARIABLES */
  :root {
    --bg-light: #fff;
    --bg-dark: #1e1e1e;
    --text-color: #FCF1F6;
    --title-color: #AD1A72;
    --num-color: #FCF1F6;
    --overlay-color: rgba(255,255,255,0.08);
    --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  [data-theme="dark"] {
    background-color: var(--bg-dark);
    color: var(--text-color);
  }
  [data-theme="light"] {
    background-color: var(--bg-light);
    color: #333;
  }
  body {
    margin: 0; padding: 0;
    font-family: var(--font-family);
    background-size: cover;
    background-position: center;
    transition: background-color 0.3s ease;
  }
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: var(--overlay-color);
    position: sticky;
    top: 0;
    z-index: 10;
  }
  h1 {
    margin: 0;
    font-weight: 700;
    color: var(--title-color);
  }
  #theme-toggle {
    cursor: pointer;
    font-size: 24px;
    user-select: none;
  }
  main {
    max-width: 480px;
    margin: 12px auto;
    background: var(--overlay-color);
    border-radius: 12px;
    padding: 12px;
    backdrop-filter: blur(6px);
  }
  /* TABS */
  #tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
  }
  #tabs button {
    flex: 1;
    padding: 8px;
    border: none;
    border-radius: 8px;
    background: transparent;
    color: var(--title-color);
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  #tabs button.active,
  #tabs button:hover {
    background: var(--title-color);
    color: var(--text-color);
  }
  section {
    display: none;
  }
  section.active {
    display: block;
  }
  /* COMMON UI */
  input[type="text"], input[type="date"], input[type="number"], input[type="file"], input[type="color"] {
    width: 100%;
    padding: 6px 8px;
    margin-top: 4px;
    margin-bottom: 12px;
    border-radius: 6px;
    border: 1.5px solid var(--title-color);
    background: transparent;
    color: var(--text-color);
    font-size: 1rem;
  }
  input[type="file"] {
    padding: 2px;
  }
  button {
    background: var(--title-color);
    border: none;
    color: var(--text-color);
    padding: 8px 12px;
    font-weight: 700;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background: #8c145c;
  }
  ul {
    list-style: none;
    padding-left: 0;
  }
  li.todo-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 8px;
    margin-bottom: 8px;
    background: var(--overlay-color);
    border-radius: 8px;
    user-select: none;
  }
  li.todo-item span.todo-text {
    flex: 1;
    margin-left: 12px;
    outline: none;
    cursor: text;
    color: var(--text-color);
  }
  li.todo-item span.todo-text.completed {
    text-decoration: line-through;
    opacity: 0.6;
  }
  li.todo-item span.due-date {
    margin-left: 12px;
    min-width: 90px;
    font-size: 0.9rem;
    color: var(--title-color);
    cursor: pointer;
    user-select: none;
  }
  li.todo-item span.due-date.placeholder {
    color: #aaa;
    font-style: italic;
  }
  li.todo-item button.close-btn {
    background: transparent;
    border: none;
    font-size: 20px;
    line-height: 1;
    cursor: pointer;
    color: var(--title-color);
    margin-left: 12px;
  }
  /* Bullet styles */
  span.bullet {
    cursor: pointer;
    user-select: none;
    font-size: 18px;
    line-height: 1;
  }
  .heart-outline { color: var(--title-color); }
  .heart-fill { color: #f54291; }
  .star-outline { color: var(--title-color); }
  .star-fill { color: #f5e942; }

  /* Stopwatch punches */
  #punches-list .punch-item {
    background: var(--overlay-color);
    padding: 4px 8px;
    margin-bottom: 4px;
    border-radius: 6px;
    color: var(--text-color);
    font-size: 0.9rem;
  }

  /* Settings group styling */
  .settings-group {
    margin-bottom: 16px;
  }
  .settings-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 4px;
    color: var(--title-color);
  }
  .settings-group input[type="file"] {
    cursor: pointer;
  }
  .settings-group button {
    margin-top: 4px;
    width: 100%;
  }

  /* Transparent overlay box for inputs */
  .transparent-box {
    background: var(--overlay-color);
    border-radius: 12px;
    padding: 10px;
    backdrop-filter: blur(6px);
    margin-bottom: 12px;
  }

  /* Theme toggle icons */
  #theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #theme-toggle svg {
    width: 26px;
    height: 26px;
    fill: var(--title-color);
  }

</style>
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
  rel="stylesheet"
/>
</head>
<body data-theme="dark">

<header>
  <h1> üóÅ Ta-da List ‚úé‚ãÜ‚≠íÀö.‚ãÜ </h1>
  <button id="theme-toggle" aria-label="Toggle light/dark theme" title="Toggle theme">
    <!-- Sun icon (light) -->
    <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display:none;">
      <circle cx="12" cy="12" r="5" fill="#AD1A72"/>
      <g stroke="#AD1A72" stroke-width="2">
        <line x1="12" y1="1" x2="12" y2="4"/>
        <line x1="12" y1="20" x2="12" y2="23"/>
        <line x1="4.22" y1="4.22" x2="6.34" y2="6.34"/>
        <line x1="17.66" y1="17.66" x2="19.78" y2="19.78"/>
        <line x1="1" y1="12" x2="4" y2="12"/>
        <line x1="20" y1="12" x2="23" y2="12"/>
        <line x1="4.22" y1="19.78" x2="6.34" y2="17.66"/>
        <line x1="17.66" y1="6.34" x2="19.78" y2="4.22"/>
      </g>
    </svg>
    <!-- Moon icon (dark) -->
    <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#AD1A72">
      <path d="M21 12.79A9 9 0 0111.21 3a7 7 0 000 14 9 9 0 009.79-4.21z"/>
    </svg>
  </button>
</header>

<main>
  <nav id="tabs" role="tablist" aria-label="Timer navigation">
    <button role="tab" aria-selected="true" aria-controls="countdown-tab" id="tab-countdown" class="active">Countdown</button>
    <button role="tab" aria-selected="false" aria-controls="timer-tab" id="tab-timer">Timer</button>
    <button role="tab" aria-selected="false" aria-controls="stopwatch-tab" id="tab-stopwatch">Stopwatch</button>
    <button role="tab" aria-selected="false" aria-controls="pomodoro-tab" id="tab-pomodoro">Pomodoro</button>
    <button role="tab" aria-selected="false" aria-controls="todo-tab" id="tab-todo">To-Do List</button>
    <button role="tab" aria-selected="false" aria-controls="settings-tab" id="tab-settings">Settings</button>
  </nav>

  <!-- COUNTDOWN -->
  <section id="countdown-tab" class="active" role="tabpanel" aria-labelledby="tab-countdown">
    <div class="transparent-box">
      <label for="cd-title-input">Countdown Title:</label>
      <input type="text" id="cd-title-input" placeholder="Enter title..." />
      <label for="cd-date-input">Select Date:</label>
      <input type="date" id="cd-date-input" />
      <button id="add-countdown" disabled>Add Countdown</button>
    </div>
    <ul id="countdown-list"></ul>
  </section>

  <!-- TIMER -->
  <section id="timer-tab" role="tabpanel" aria-labelledby="tab-timer">
    <div class="transparent-box">
      <label for="timer-seconds">Set Timer (seconds):</label>
      <input type="number" id="timer-seconds" min="1" placeholder="e.g. 60" />
      <button id="add-timer" disabled>Add Timer</button>
    </div>
    <ul id="timer-list"></ul>
  </section>

  <!-- STOPWATCH -->
  <section id="stopwatch-tab" role="tabpanel" aria-labelledby="tab-stopwatch">
    <div class="transparent-box" style="text-align:center; font-size:2rem; font-weight:700; color: var(--num-color);" id="stopwatch-display">00:00:00</div>
    <div style="display:flex; gap:8px; justify-content:center; margin-bottom:12px;">
      <button id="sw-start"><i class="fas fa-play"></i></button>
      <button id="sw-stop" disabled><i class="fas fa-pause"></i></button>
      <button id="sw-reset" disabled><i class="fas fa-undo"></i></button>
      <button id="sw-punch" disabled title="Mark punch"><i class="fas fa-thumbtack"></i></button>
    </div>
    <div id="punches-list"></div>
  </section>

  <!-- POMODORO -->
  <section id="pomodoro-tab" role="tabpanel" aria-labelledby="tab-pomodoro">
    <div class="transparent-box" style="text-align:center; font-size:2rem; font-weight:700; color: var(--num-color);" id="pomodoro-display">25:00</div>
    <div style="display:flex; gap:8px; justify-content:center;">
      <button id="pomodoro-start"><i class="fas fa-play"></i></button>
      <button id="pomodoro-stop" disabled><i class="fas fa-pause"></i></button>
      <button id="pomodoro-reset" disabled><i class="fas fa-undo"></i></button>
    </div>
  </section>

  <!-- TO-DO LIST -->
  <section id="todo-tab" role="tabpanel" aria-labelledby="tab-todo">
    <div class="transparent-box">
      <input type="text" id="todo-input" placeholder="Add task & press Enter (Tab to toggle subtask)" autocomplete="off" />
      <button id="todo-reset">Clear All Tasks</button>
    </div>
    <ul id="todo-list"></ul>
  </section>

  <!-- SETTINGS -->
  <section id="settings-tab" role="tabpanel" aria-labelledby="tab-settings">
    <div class="transparent-box settings-group">
      <label for="text-color-input">Text Color (Hex):</label>
      <input type="text" id="text-color-input" placeholder="#FCF1F6" maxlength="7" />
      <input type="color" id="text-color-picker" />
    </div>
    <div class="transparent-box settings-group">
      <label for="title-color-input">Title Color (Hex):</label>
      <input type="text" id="title-color-input" placeholder="#AD1A72" maxlength="7" />
      <input type="color" id="title-color-picker" />
    </div>
    <div class="transparent-box settings-group">
      <label for="num-color-input">Number Color (Hex):</label>
      <input type="text" id="num-color-input" placeholder="#FCF1F6" maxlength="7" />
      <input type="color" id="num-color-picker" />
    </div>
    <div class="transparent-box settings-group">
      <label for="overlay-color-input">Overlay Color (rgba):</label>
      <input type="text" id="overlay-color-input" placeholder="rgba(255,255,255,0.08)" />
    </div>
    <div class="transparent-box settings-group">
      <label for="bg-upload">Upload Background Image:</label>
      <input type="file" id="bg-upload" accept="image/*" />
      <button id="bg-clear">Clear Background</button>
    </div>
    <div class="transparent-box settings-group">
      <label for="alarm-upload">Upload Custom Alarm Sound:</label>
      <input type="file" id="alarm-upload" accept="audio/*" />
      <button id="alarm-clear" title="Clear custom alarm">Clear Alarm</button>
    </div>
  </section>
</main>

<!-- Default alarm sound -->
<audio
  id="alarm-sound"
  src="https://cdn.pixabay.com/download/audio/2021/09/22/audio_1a9c1a07cc.mp3?filename=bell-notification-6055.mp3"
  preload="auto"
></audio>

<script>
(() => {
  // Utility to check hex validity
  function isValidHex(hex) {
    return /^#([0-9A-Fa-f]{6})$/.test(hex);
  }

  // Color inputs
  const inputs = {
    text: document.getElementById('text-color-input'),
    title: document.getElementById('title-color-input'),
    num: document.getElementById('num-color-input'),
    overlay: document.getElementById('overlay-color-input'),
    textPicker: document.getElementById('text-color-picker'),
    titlePicker: document.getElementById('title-color-picker'),
    numPicker: document.getElementById('num-color-picker'),
  };

  // Set colors on :root
  function setColors({ text, title, num, overlay }, save = true) {
    if (text && isValidHex(text))
      document.documentElement.style.setProperty('--text-color', text);
    if (title && isValidHex(title))
      document.documentElement.style.setProperty('--title-color', title);
    if (num && isValidHex(num))
      document.documentElement.style.setProperty('--num-color', num);
    if (overlay) document.documentElement.style.setProperty('--overlay-color', overlay);
    if (save) saveColorsToStorage({ text, title, num, overlay });
  }

  // Load colors from storage
  function loadColorsFromStorage() {
    const saved = JSON.parse(localStorage.getItem('colors'));
    if (saved) setColors(saved, false);
    // Also update input values
    if (saved) {
      inputs.text.value = saved.text || '';
      inputs.title.value = saved.title || '';
      inputs.num.value = saved.num || '';
      inputs.overlay.value = saved.overlay || '';
      if (isValidHex(saved.text)) inputs.textPicker.value = saved.text;
      if (isValidHex(saved.title)) inputs.titlePicker.value = saved.title;
      if (isValidHex(saved.num)) inputs.numPicker.value = saved.num;
    }
  }
  loadColorsFromStorage();

  // Save colors
  function saveColorsToStorage(colors) {
    localStorage.setItem('colors', JSON.stringify(colors));
  }

  // Sync hex inputs and color pickers, live update
  function setupColorSync(hexInput, colorInput, prop) {
    hexInput.addEventListener('input', () => {
      let val = hexInput.value.trim();
      if (!val.startsWith('#')) val = '#' + val;
      if (isValidHex(val)) {
        colorInput.value = val;
        updateColor(prop, val);
      }
    });
    colorInput.addEventListener('input', () => {
      const val = colorInput.value;
      hexInput.value = val;
      updateColor(prop, val);
    });
  }
  function updateColor(prop, val) {
    const colors = {
      text: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim(),
      title: getComputedStyle(document.documentElement).getPropertyValue('--title-color').trim(),
      num: getComputedStyle(document.documentElement).getPropertyValue('--num-color').trim(),
      overlay: getComputedStyle(document.documentElement).getPropertyValue('--overlay-color').trim(),
    };
    colors[prop] = val;
    setColors(colors);
  }
  setupColorSync(inputs.text, inputs.textPicker, 'text');
  setupColorSync(inputs.title, inputs.titlePicker, 'title');
  setupColorSync(inputs.num, inputs.numPicker, 'num');

  // Overlay color input
  inputs.overlay.addEventListener('input', () => {
    const val = inputs.overlay.value.trim();
    if (val.startsWith('rgba') || val.startsWith('rgb') || val === '') {
      const colors = {
        text: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim(),
        title: getComputedStyle(document.documentElement).getPropertyValue('--title-color').trim(),
        num: getComputedStyle(document.documentElement).getPropertyValue('--num-color').trim(),
        overlay: val || 'rgba(255,255,255,0.08)',
      };
      setColors(colors);
    }
  });

  // BACKGROUND IMAGE UPLOAD & CLEAR
  const bgUpload = document.getElementById('bg-upload');
  const bgClear = document.getElementById('bg-clear');

  function setBackgroundImage(dataUrl) {
    document.body.style.backgroundImage = dataUrl ? `url(${dataUrl})` : '';
    if (dataUrl) {
      localStorage.setItem('bgImage', dataUrl);
    } else {
      localStorage.removeItem('bgImage');
    }
  }
  bgUpload.addEventListener('change', () => {
    const file = bgUpload.files[0];
    if (!file) return;
    if (!file.type.startsWith('image/')) {
      alert('Please upload a valid image file.');
      return;
    }
    const reader = new FileReader();
    reader.onload = e => {
      setBackgroundImage(e.target.result);
    };
    reader.readAsDataURL(file);
  });
  bgClear.addEventListener('click', () => {
    if (confirm('Clear background image?')) {
      setBackgroundImage(null);
      bgUpload.value = '';
    }
  });
  // Load saved background on init
  const savedBg = localStorage.getItem('bgImage');
  if (savedBg) setBackgroundImage(savedBg);

  // THEME TOGGLE
  const themeToggle = document.getElementById('theme-toggle');
  const iconSun = document.getElementById('icon-sun');
  const iconMoon = document.getElementById('icon-moon');

  function applyTheme(theme) {
    document.body.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    if (theme === 'dark') {
      iconSun.style.display = 'block';
      iconMoon.style.display = 'none';
    } else {
      iconSun.style.display = 'none';
      iconMoon.style.display = 'block';
    }
  }

  let currentTheme = localStorage.getItem('theme') || 'dark';
  applyTheme(currentTheme);

  themeToggle.addEventListener('click', () => {
    currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
    applyTheme(currentTheme);
  });

  // TABS
  const tabs = document.querySelectorAll('#tabs button');
  const sections = document.querySelectorAll('main section');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => {
        t.classList.remove('active');
        t.setAttribute('aria-selected', 'false');
      });
      tab.classList.add('active');
      tab.setAttribute('aria-selected', 'true');
      const target = tab.getAttribute('aria-controls');
      sections.forEach(s => {
        s.classList.toggle('active', s.id === target);
      });
    });
  });

  // COUNTDOWN TIMERS
  const cdTitleInput = document.getElementById('cd-title-input');
  const cdDateInput = document.getElementById('cd-date-input');
  const addCountdownBtn = document.getElementById('add-countdown');
  const countdownList = document.getElementById('countdown-list');

  let countdowns = JSON.parse(localStorage.getItem('countdowns') || '[]');

  function saveCountdowns() {
    localStorage.setItem('countdowns', JSON.stringify(countdowns));
  }

  function renderCountdowns() {
    countdownList.innerHTML = '';
    if (countdowns.length === 0) {
      countdownList.innerHTML = '<li>No countdowns added yet.</li>';
      return;
    }
    countdowns.forEach((cd, i) => {
      const li = document.createElement('li');
      li.style.marginBottom = '12px';
      li.style.padding = '12px';
      li.style.background = 'var(--overlay-color)';
      li.style.borderRadius = '12px';

      // Editable title
      const title = document.createElement('input');
      title.type = 'text';
      title.value = cd.title;
      title.style.width = '100%';
      title.style.fontWeight = '700';
      title.style.fontSize = '1.2rem';
      title.style.color = 'var(--title-color)';
      title.style.background = 'transparent';
      title.style.border = 'none';
      title.style.outline = 'none';
      title.addEventListener('input', () => {
        countdowns[i].title = title.value.trim() || 'Untitled';
        saveCountdowns();
      });
      li.appendChild(title);

      // Date input
      const dateInput = document.createElement('input');
      dateInput.type = 'date';
      dateInput.value = cd.date;
      dateInput.style.marginTop = '8px';
      dateInput.style.width = '100%';
      dateInput.addEventListener('change', () => {
        countdowns[i].date = dateInput.value;
        saveCountdowns();
      });
      li.appendChild(dateInput);

      // Countdown display
      const display = document.createElement('div');
      display.style.fontSize = '1.6rem';
      display.style.fontWeight = '700';
      display.style.color = 'var(--num-color)';
      display.style.marginTop = '8px';
      li.appendChild(display);

      // Remove button
      const removeBtn = document.createElement('button');
      removeBtn.textContent = 'Remove';
      removeBtn.style.marginTop = '8px';
      removeBtn.addEventListener('click', () => {
        countdowns.splice(i, 1);
        saveCountdowns();
        renderCountdowns();
      });
      li.appendChild(removeBtn);

      countdownList.appendChild(li);

      // Update countdown timer display
      function updateCountdown() {
        const now = new Date();
        const target = new Date(cd.date + 'T00:00:00');
        const diff = target - now;
        if (diff <= 0) {
          display.textContent = "üéâ Time's up!";
          if(!cd.notified) {
            playAlarm();
            countdowns[i].notified = true;
            saveCountdowns();
          }
          return;
        }
        const days = Math.floor(diff / (1000*60*60*24));
        const hours = Math.floor((diff / (1000*60*60)) % 24);
        const mins = Math.floor((diff / (1000*60)) % 60);
        const secs = Math.floor((diff / 1000) % 60);
        display.textContent = `${days}d ${hours}h ${mins}m ${secs}s`;
      }
      updateCountdown();
      setInterval(updateCountdown, 1000);
    });
  }
  renderCountdowns();

  function checkAddCountdownBtn() {
    addCountdownBtn.disabled = !(cdTitleInput.value.trim() && cdDateInput.value);
  }
  cdTitleInput.addEventListener('input', checkAddCountdownBtn);
  cdDateInput.addEventListener('input', checkAddCountdownBtn);

  addCountdownBtn.addEventListener('click', () => {
    countdowns.unshift({
      title: cdTitleInput.value.trim(),
      date: cdDateInput.value,
      notified: false,
    });
    saveCountdowns();
    renderCountdowns();
    cdTitleInput.value = '';
    cdDateInput.value = '';
    addCountdownBtn.disabled = true;
  });

  // TIMER LIST
  const timerSecondsInput = document.getElementById('timer-seconds');
  const addTimerBtn = document.getElementById('add-timer');
  const timerList = document.getElementById('timer-list');

  let timers = JSON.parse(localStorage.getItem('timers') || '[]');

  function saveTimers() {
    localStorage.setItem('timers', JSON.stringify(timers));
  }

  function renderTimers() {
    timerList.innerHTML = '';
    if (timers.length === 0) {
      timerList.innerHTML = '<li>No timers added yet.</li>';
      return;
    }
    timers.forEach((t, i) => {
      const li = document.createElement('li');
      li.style.marginBottom = '12px';
      li.style.padding = '12px';
      li.style.background = 'var(--overlay-color)';
      li.style.borderRadius = '12px';
      li.style.color = 'var(--text-color)';

      const display = document.createElement('div');
      display.style.fontSize = '1.6rem';
      display.style.fontWeight = '700';
      display.textContent = formatTime(t.remaining);
      li.appendChild(display);

      const controls = document.createElement('div');
      controls.style.marginTop = '8px';
      controls.style.display = 'flex';
      controls.style.gap = '8px';

      const startBtn = document.createElement('button');
      startBtn.innerHTML = '<i class="fas fa-play"></i>';
      startBtn.title = 'Start';
      const pauseBtn = document.createElement('button');
      pauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
      pauseBtn.title = 'Pause';
      pauseBtn.disabled = true;
      const resetBtn = document.createElement('button');
      resetBtn.innerHTML = '<i class="fas fa-undo"></i>';
      resetBtn.title = 'Reset';

      controls.appendChild(startBtn);
      controls.appendChild(pauseBtn);
      controls.appendChild(resetBtn);
      li.appendChild(controls);

      timerList.appendChild(li);

      let timerInterval = null;

      startBtn.addEventListener('click', () => {
        if (timerInterval) return;
        if (t.remaining <= 0) {
          t.remaining = t.duration;
          saveTimers();
        }
        startBtn.disabled = true;
        pauseBtn.disabled = false;

        timerInterval = setInterval(() => {
          if (t.remaining > 0) {
            t.remaining--;
            display.textContent = formatTime(t.remaining);
          } else {
            clearInterval(timerInterval);
            timerInterval = null;
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            playAlarm();
          }
          saveTimers();
        }, 1000);
      });

      pauseBtn.addEventListener('click', () => {
        clearInterval(timerInterval);
        timerInterval = null;
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        saveTimers();
      });

      resetBtn.addEventListener('click', () => {
        clearInterval(timerInterval);
        timerInterval = null;
        t.remaining = t.duration;
        display.textContent = formatTime(t.remaining);
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        saveTimers();
      });
    });
  }
  renderTimers();

  function checkAddTimerBtn() {
    addTimerBtn.disabled = !(timerSecondsInput.value > 0);
  }
  timerSecondsInput.addEventListener('input', checkAddTimerBtn);

  addTimerBtn.addEventListener('click', () => {
    const seconds = parseInt(timerSecondsInput.value);
    if (!seconds || seconds <= 0) return;
    timers.unshift({
      duration: seconds,
      remaining: seconds,
    });
    saveTimers();
    renderTimers();
    timerSecondsInput.value = '';
    addTimerBtn.disabled = true;
  });

  // FORMAT TIME UTILITY
  function formatTime(seconds) {
    const hrs = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    return [
      hrs.toString().padStart(2, '0'),
      mins.toString().padStart(2, '0'),
      secs.toString().padStart(2, '0'),
    ].join(':');
  }

  // STOPWATCH
  const swDisplay = document.getElementById('stopwatch-display');
  const swStartBtn = document.getElementById('sw-start');
  const swStopBtn = document.getElementById('sw-stop');
  const swResetBtn = document.getElementById('sw-reset');
  const swPunchBtn = document.getElementById('sw-punch');
  const punchesList = document.getElementById('punches-list');

  let swInterval = null;
  let swTime = 0;
  let punches = JSON.parse(localStorage.getItem('punches') || '[]');

  function renderPunches() {
    punchesList.innerHTML = '';
    punches.forEach((p, i) => {
      const div = document.createElement('div');
      div.className = 'punch-item';
      div.textContent = `Punch ${i + 1}: ${formatTime(p)}`;
      punchesList.appendChild(div);
    });
  }
  renderPunches();

  function updateStopwatchDisplay() {
    swDisplay.textContent = formatTime(swTime);
  }
  updateStopwatchDisplay();

  swStartBtn.addEventListener('click', () => {
    if (swInterval) return;
    swInterval = setInterval(() => {
      swTime++;
      updateStopwatchDisplay();
      saveStopwatch();
    }, 1000);
    swStartBtn.disabled = true;
    swStopBtn.disabled = false;
    swResetBtn.disabled = false;
    swPunchBtn.disabled = false;
  });

  swStopBtn.addEventListener('click', () => {
    clearInterval(swInterval);
    swInterval = null;
    swStartBtn.disabled = false;
    swStopBtn.disabled = true;
  });

  swResetBtn.addEventListener('click', () => {
    clearInterval(swInterval);
    swInterval = null;
    swTime = 0;
    punches = [];
    saveStopwatch();
    updateStopwatchDisplay();
    renderPunches();
    swStartBtn.disabled = false;
    swStopBtn.disabled = true;
    swResetBtn.disabled = true;
    swPunchBtn.disabled = true;
  });

  swPunchBtn.addEventListener('click', () => {
    punches.push(swTime);
    saveStopwatch();
    renderPunches();
  });

  function saveStopwatch() {
    localStorage.setItem('stopwatchTime', swTime);
    localStorage.setItem('punches', JSON.stringify(punches));
  }
  function loadStopwatch() {
    const t = parseInt(localStorage.getItem('stopwatchTime'));
    if (!isNaN(t)) swTime = t;
    const p = JSON.parse(localStorage.getItem('punches'));
    if (p && Array.isArray(p)) punches = p;
  }
  loadStopwatch();

  // POMODORO TIMER
  const pomoDisplay = document.getElementById('pomodoro-display');
  const pomoStartBtn = document.getElementById('pomodoro-start');
  const pomoStopBtn = document.getElementById('pomodoro-stop');
  const pomoResetBtn = document.getElementById('pomodoro-reset');

  const pomoWorkDuration = 25 * 60; // 25 minutes
  const pomoBreakDuration = 5 * 60; // 5 minutes

  let pomoInterval = null;
  let pomoTime = pomoWorkDuration;
  let pomoIsBreak = false;

  function updatePomodoroDisplay() {
    const mins = Math.floor(pomoTime / 60);
    const secs = pomoTime % 60;
    pomoDisplay.textContent = `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
    pomoDisplay.style.color = pomoIsBreak ? '#42a5f5' : 'var(--num-color)';
  }
  updatePomodoroDisplay();

  pomoStartBtn.addEventListener('click', () => {
    if (pomoInterval) return;
    pomoInterval = setInterval(() => {
      if (pomoTime > 0) {
        pomoTime--;
        updatePomodoroDisplay();
      } else {
        playAlarm();
        if (pomoIsBreak) {
          pomoTime = pomoWorkDuration;
          pomoIsBreak = false;
        } else {
          pomoTime = pomoBreakDuration;
          pomoIsBreak = true;
        }
        updatePomodoroDisplay();
      }
    }, 1000);
    pomoStartBtn.disabled = true;
    pomoStopBtn.disabled = false;
    pomoResetBtn.disabled = false;
  });

  pomoStopBtn.addEventListener('click', () => {
    clearInterval(pomoInterval);
    pomoInterval = null;
    pomoStartBtn.disabled = false;
    pomoStopBtn.disabled = true;
  });

  pomoResetBtn.addEventListener('click', () => {
    clearInterval(pomoInterval);
    pomoInterval = null;
    pomoTime = pomoWorkDuration;
    pomoIsBreak = false;
    updatePomodoroDisplay();
    pomoStartBtn.disabled = false;
    pomoStopBtn.disabled = true;
    pomoResetBtn.disabled = true;
  });

  // TO-DO LIST
  const todoInput = document.getElementById('todo-input');
  const todoList = document.getElementById('todo-list');
  const todoResetBtn = document.getElementById('todo-reset');

  let todos = JSON.parse(localStorage.getItem('todos') || '[]');

  function saveTodos() {
    localStorage.setItem('todos', JSON.stringify(todos));
  }

  function renderTodos() {
    todoList.innerHTML = '';
    if (todos.length === 0) {
      todoList.innerHTML = '<li style="color:#aaa;">No tasks yet.</li>';
      return;
    }
    todos.forEach((task, i) => {
      const li = document.createElement('li');
      li.className = 'todo-item';
      li.setAttribute('draggable', 'true');
      li.setAttribute('aria-grabbed', 'false');

      const bullet = document.createElement('span');
      bullet.className = 'bullet';
      bullet.innerHTML = task.subtask ? (task.completed ? '&#9733;' : '&#9734;') : (task.completed ? '&#10084;' : '&#9825;'); // star or heart filled/outline
      bullet.classList.add(task.subtask ? (task.completed ? 'star-fill' : 'star-outline') : (task.completed ? 'heart-fill' : 'heart-outline'));
      bullet.style.userSelect = 'none';
      bullet.title = task.subtask ? 'Subtask completion toggle' : 'Task completion toggle';
      bullet.addEventListener('click', () => {
        todos[i].completed = !todos[i].completed;
        saveTodos();
        renderTodos();
      });
      li.appendChild(bullet);

      // Editable task text
      const taskText = document.createElement('span');
      taskText.className = 'todo-text';
      taskText.contentEditable = true;
      taskText.spellcheck = false;
      taskText.textContent = task.text;
      if (task.completed) taskText.classList.add('completed');
      taskText.addEventListener('input', () => {
        todos[i].text = taskText.textContent.trim();
        saveTodos();
      });
      taskText.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          e.preventDefault();
          todoInput.focus();
        }
      });
      li.appendChild(taskText);

      // Due date
      const dueDateSpan = document.createElement('span');
      dueDateSpan.className = 'due-date';
      if (task.dueDate) {
        dueDateSpan.textContent = task.dueDate;
        dueDateSpan.classList.remove('placeholder');
      } else {
        dueDateSpan.textContent = 'Add Due Date';
        dueDateSpan.classList.add('placeholder');
      }
      dueDateSpan.title = 'Click to edit due date';
      dueDateSpan.addEventListener('click', () => {
        const input = document.createElement('input');
        input.type = 'date';
        input.value = task.dueDate || '';
        input.style.width = '130px';
        input.addEventListener('change', () => {
          todos[i].dueDate = input.value;
          saveTodos();
          renderTodos();
        });
        input.addEventListener('blur', () => {
          renderTodos();
        });
        dueDateSpan.replaceWith(input);
        input.focus();
      });
      li.appendChild(dueDateSpan);

      // Remove button
      const removeBtn = document.createElement('button');
      removeBtn.className = 'close-btn';
      removeBtn.title = 'Remove task';
      removeBtn.innerHTML = '<i class="fas fa-times"></i>';
      removeBtn.addEventListener('click', () => {
        todos.splice(i, 1);
        saveTodos();
        renderTodos();
      });
      li.appendChild(removeBtn);

      // Drag and drop handlers
      li.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', i.toString());
        li.setAttribute('aria-grabbed', 'true');
      });
      li.addEventListener('dragend', e => {
        li.setAttribute('aria-grabbed', 'false');
      });
      li.addEventListener('dragover', e => {
        e.preventDefault();
      });
      li.addEventListener('drop', e => {
        e.preventDefault();
        const fromIndex = parseInt(e.dataTransfer.getData('text/plain'));
        const toIndex = i;
        if (fromIndex !== toIndex) {
          const movedItem = todos.splice(fromIndex, 1)[0];
          todos.splice(toIndex, 0, movedItem);
          saveTodos();
          renderTodos();
        }
      });

      todoList.appendChild(li);
    });
  }
  renderTodos();

  todoResetBtn.addEventListener('click', () => {
    if (confirm('Clear entire to-do list?')) {
      todos = [];
      saveTodos();
      renderTodos();
    }
  });

  // Add todo from input
  todoInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      e.preventDefault();
      addTodoFromInput();
    } else if (e.key === 'Tab') {
      e.preventDefault();
      // Toggle subtask or main task on input text
      todoInput.dataset.subtask = todoInput.dataset.subtask === 'true' ? 'false' : 'true';
      updateTodoPlaceholder();
    }
  });

  function updateTodoPlaceholder() {
    if (todoInput.dataset.subtask === 'true') {
      todoInput.placeholder = 'Add subtask & press Enter (Tab to toggle)';
    } else {
      todoInput.placeholder = 'Add task & press Enter (Tab to toggle subtask)';
    }
  }
  updateTodoPlaceholder();

  function addTodoFromInput() {
    const text = todoInput.value.trim();
    if (!text) return;
    const subtask = todoInput.dataset.subtask === 'true';
    todos.unshift({
      text,
      completed: false,
      subtask,
      dueDate: '',
    });
    saveTodos();
    renderTodos();
    todoInput.value = '';
  }

  // ALARM SOUND: default + custom upload/clear
  const alarmSound = document.getElementById('alarm-sound');
  const alarmUpload = document.getElementById('alarm-upload');
  const alarmClearBtn = document.getElementById('alarm-clear');

  function playAlarm() {
    alarmSound.pause();
    alarmSound.currentTime = 0;
    alarmSound.play();
  }

  // Load custom alarm from storage (base64)
  function loadCustomAlarm() {
    const dataUrl = localStorage.getItem('customAlarm');
    if (dataUrl) {
      alarmSound.src = dataUrl;
    } else {
      alarmSound.src = "https://cdn.pixabay.com/download/audio/2021/09/22/audio_1a9c1a07cc.mp3?filename=bell-notification-6055.mp3";
    }
  }
  loadCustomAlarm();

  alarmUpload.addEventListener('change', () => {
    const file = alarmUpload.files[0];
    if (!file) return;
    if (!file.type.startsWith('audio/')) {
      alert('Please upload a valid audio file.');
      return;
    }
    const reader = new FileReader();
    reader.onload = e => {
      alarmSound.src = e.target.result;
      localStorage.setItem('customAlarm', e.target.result);
      alert('Custom alarm uploaded!');
    };
    reader.readAsDataURL(file);
  });

  alarmClearBtn.addEventListener('click', () => {
    if (confirm('Clear custom alarm and restore default?')) {
      localStorage.removeItem('customAlarm');
      loadCustomAlarm();
      alarmUpload.value = '';
    }
  });
})();
</script>

</body>
</html>
