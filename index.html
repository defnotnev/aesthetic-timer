<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ultimate Study Widget</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
  <style>
    :root {
      --bg-dark: #1a1a1a;
      --bg-light: #fefefe;
      --text-dark: #fcf1f6;
      --text-light: #1a1a1a;
      --title-dark: #ad1a72;
      --title-light: #ad1a72;
      --outline-dark: rgba(255 255 255 / 0.12);
      --outline-light: rgba(0 0 0 / 0.12);
      --input-bg-dark: #222;
      --input-bg-light: #eee;
    }
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      user-select: none;
    }
    body[data-theme='dark'] { background: var(--bg-dark); color: var(--text-dark); }
    body[data-theme='light'] { background: var(--bg-light); color: var(--text-light); }
    header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 1rem 1.5rem; border-bottom: 1px solid var(--outline-dark); background-color: inherit;
    }
    body[data-theme='light'] header { border-color: var(--outline-light); }
    header h1 { font-weight: 900; font-size: 1.6rem; color: var(--title-dark); margin: 0; }
    #theme-toggle {
      background: none; border: none; cursor: pointer; font-size: 1.8rem; color: var(--title-dark);
      position: relative; width: 2.5rem; height: 2.5rem;
    }
    #icon-sun, #icon-moon {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0; margin: auto; transition: opacity 0.3s ease;
    }
    body[data-theme='dark'] #icon-sun { opacity: 0; }
    body[data-theme='light'] #icon-moon { opacity: 0; }
    nav#tabs {
      display: flex; background: inherit; border-bottom: 1px solid var(--outline-dark);
    }
    body[data-theme='light'] nav#tabs { border-color: var(--outline-light); }
    nav#tabs button {
      flex: 1 1 0; border: none; background: none; cursor: pointer; padding: 0.75rem 0.5rem;
      font-weight: 600; font-size: 1rem; color: var(--title-dark); border-bottom: 3px solid transparent;
      transition: border-color 0.3s ease, background-color 0.3s ease;
    }
    nav#tabs button[aria-selected="true"] {
      border-color: var(--title-dark); font-weight: 900; background-color: rgba(173, 26, 114, 0.12);
    }
    nav#tabs button:hover:not([aria-selected="true"]) { background-color: rgba(173, 26, 114, 0.08); }
    main {
      height: calc(100vh - 104px); overflow-y: auto; padding: 1rem 1.5rem 2rem 1.5rem;
      background-position: center; background-repeat: no-repeat; background-size: cover; position: relative;
    }
    .blurred-outline {
      background: rgba(255 255 255 / 0.08); backdrop-filter: blur(10px); border: 1px solid var(--outline-dark);
      border-radius: 12px; padding: 1rem; margin-bottom: 1rem;
    }
    body[data-theme='light'] .blurred-outline { background: rgba(0 0 0 / 0.04); border-color: var(--outline-light); }
    section[role="tabpanel"] { display: none; }
    section[role="tabpanel"].active { display: block; }
    /* To-Do List styles */
    #todo-list { list-style: none; margin: 0 0 0.5rem 0; padding: 0; max-height: 350px; overflow-y: auto; }
    #todo-list li { display: flex; align-items: center; padding: 0.4rem 0.5rem; border-bottom: 1px solid var(--outline-dark); position: relative; }
    body[data-theme='light'] #todo-list li { border-color: var(--outline-light); }
    #todo-list li.todo-item.dragging { opacity: 0.5; }
    .bullet { border: none; background: none; cursor: pointer; margin-right: 0.5rem; font-size: 1.3rem; color: var(--title-dark); flex-shrink: 0; }
    .bullet:hover { color: #ff69b4; }
    .heart-outline, .star-outline { color: var(--title-dark); }
    .heart-fill, .star-fill { color: #e91e63; }
    .todo-text { flex-grow: 1; outline: none; font-size: 1.1rem; word-break: break-word; padding: 0.1rem 0.2rem; min-height: 1.3rem; }
    .todo-text.completed { text-decoration: line-through; opacity: 0.6; }
    .due-date { margin-left: 1rem; font-size: 0.85rem; cursor: pointer; color: var(--title-dark); user-select: none; }
    .due-date.placeholder { opacity: 0.3; font-style: italic; }
    .due-date:hover { text-decoration: underline; }
    .close-btn { background: none; border: none; color: var(--title-dark); cursor: pointer; margin-left: 1rem; font-size: 1.2rem; flex-shrink: 0; }
    .close-btn:hover { color: #ff4081; }
    #todo-input-container { display: flex; align-items: center; margin-top: 0.5rem; }
    #todo-input {
      flex-grow: 1; font-size: 1.1rem; padding: 0.4rem 0.6rem; border-radius: 8px; border: 1px solid var(--outline-dark);
      background-color: var(--input-bg-dark); color: var(--text-dark); transition: border-color 0.3s ease; user-select: text;
    }
    body[data-theme='light'] #todo-input { border-color: var(--outline-light); background-color: var(--input-bg-light); color: var(--text-light); }
    #todo-input:focus { border-color: #ad1a72; outline: none; }
    #todo-toggle-subtask { margin-right: 0.75rem; background: none; border: none; cursor: pointer; font-size: 1.5rem; color: var(--title-dark); transition: color 0.3s ease; }
    #todo-toggle-subtask.active { color: #e91e63; }
    #todo-toggle-subtask:hover { color: #ff69b4; }
    .reset-btn { margin-top: 1rem; padding: 0.45rem 1rem; border: none; border-radius: 8px; cursor: pointer; background-color: var(--title-dark); color: #fff; font-weight: 700; transition: background-color 0.3s ease; user-select: none; }
    .reset-btn:hover { background-color: #6f1351; }
    .timer-list, .countdown-list { max-height: 320px; overflow-y: auto; margin-bottom: 1rem; }
    .timer-card, .countdown-card {
      background: rgba(255 255 255 / 0.08); backdrop-filter: blur(10px); border: 1px solid var(--outline-dark);
      border-radius: 12px; padding: 1rem; margin-bottom: 0.8rem; position: relative;
    }
    body[data-theme='light'] .timer-card, body[data-theme='light'] .countdown-card { background: rgba(0 0 0 / 0.04); border-color: var(--outline-light); }
    .timer-card > *, .countdown-card > * { margin: 0.15rem 0; }
    .editable-title { font-weight: 900; font-size: 1.2rem; color: var(--title-dark); user-select: text; outline: none; }
    .countdown-time { font-size: 1.6rem; font-weight: 900; font-family: monospace, monospace; color: var(--text-dark); user-select: none; }
    body[data-theme='light'] .countdown-time { color: var(--text-light); }
    .timer-controls button, .countdown-controls button {
      background: none; border: none; color: var(--title-dark); cursor: pointer; font-size: 1.25rem; margin-left: 0.5rem; transition: color 0.3s ease;
    }
    .timer-controls button:hover, .countdown-controls button:hover { color: #e91e63; }
    .close-btn-timer { position: absolute; top: 0.5rem; right: 0.6rem; font-size: 1.3rem; cursor: pointer; color: var(--title-dark); background: none; border: none; }
    .close-btn-timer:hover { color: #ff4081; }
    input[type="date"], input[type="time"] {
      padding: 0.3rem 0.5rem; border-radius: 8px; border: 1px solid var(--outline-dark); background-color: var(--input-bg-dark); color: var(--text-dark); font-size: 1rem;
    }
    body[data-theme='light'] input[type="date"], body[data-theme='light'] input[type="time"] { border-color: var(--outline-light); background-color: var(--input-bg-light); color: var(--text-light); }
    input[type="date"]:focus, input[type="time"]:focus { outline: none; border-color: #ad1a72; }
    #pomodoro-display { font-size: 3rem; font-weight: 900; font-family: monospace, monospace; text-align: center; margin: 2rem 0 1rem 0; color: var(--text-dark); }
    body[data-theme='light'] #pomodoro-display { color: var(--text-light); }
    #pomodoro-controls { display: flex; justify-content: center; gap: 1rem; }
    #pomodoro-controls button {
      background: none; border: 2px solid var(--title-dark); border-radius: 50%; color: var(--title-dark);
      width: 3rem; height: 3rem; font-size: 1.5rem; cursor: pointer; transition: background-color 0.3s ease;
    }
    #pomodoro-controls button:hover { background-color: #ff69b4; color: white; }
    #stopwatch-display { font-size: 3rem; font-weight: 900; font-family: monospace, monospace; text-align: center; margin-bottom: 1rem; color: var(--text-dark); }
    body[data-theme='light'] #stopwatch-display { color: var(--text-light); }
    #stopwatch-controls { display: flex; justify-content: center; gap: 1rem; margin-bottom: 1rem; }
    #stopwatch-controls button {
      background: none; border: 2px solid var(--title-dark); border-radius: 8px; color: var(--title-dark);
      padding: 0.4rem 1rem; font-weight: 700; cursor: pointer; transition: background-color 0.3s ease;
    }
    #stopwatch-controls button:hover { background-color: #ff69b4; color: white; }
    #punches-list {
      max-height: 160px; overflow-y: auto; background: rgba(255 255 255 / 0.08); backdrop-filter: blur(10px);
      border: 1px solid var(--outline-dark); border-radius: 12px; padding: 0.5rem 1rem; font-family: monospace, monospace; color: var(--text-dark);
    }
    body[data-theme='light'] #punches-list { background: rgba(0 0 0 / 0.04); border-color: var(--outline-light); color: var(--text-light); }
    #punches-list li { margin-bottom: 0.3rem; }
    #settings form { max-width: 460px; margin: auto; }
    #settings label { display: block; margin-top: 1rem; font-weight: 700; color: var(--title-dark); }
    #settings input[type="color"], #settings input[type="text"] {
      margin-top: 0.3rem; padding: 0.3rem 0.5rem; border-radius: 6px; border: 1px solid var(--outline-dark); font-size: 1rem; width: 100%; box-sizing: border-box;
    }
    body[data-theme='light'] #settings input[type="color"], body[data-theme='light'] #settings input[type="text"] { border-color: var(--outline-light); }
    #settings button { margin-top: 1rem; background-color: var(--title-dark); color: white; border: none; border-radius: 8px; padding: 0.5rem 1.2rem; font-weight: 700; cursor: pointer; }
    #settings button:hover { background-color: #6f1351; }
    #settings small { font-style: italic; color: var(--text-dark); }
    body[data-theme='light'] #settings small { color: var(--text-light); }
    #bg-reposition-container {
      margin-top: 1rem; position: relative; border: 1px solid var(--outline-dark); border-radius: 12px; overflow: hidden; max-width: 100%; height: 180px;
    }
    body[data-theme='light'] #bg-reposition-container { border-color: var(--outline-light); }
    #bg-reposition-image { position: absolute; top: 0; left: 0; user-select: none; cursor: grab; max-width: none; }
    #bg-reposition-image.dragging { cursor: grabbing; }
    #bg-reposition-controls { margin-top: 0.6rem; display: flex; justify-content: space-between; }
    #bg-reposition-controls button { padding: 0.3rem 0.7rem; border: none; background: var(--title-dark); color: white; border-radius: 8px; cursor: pointer; font-weight: 700; }
    #bg-reposition-controls button:hover { background: #6f1351; }
    #chat-container { max-width: 700px; margin: 0 auto; display: flex; flex-direction: column; height: 500px; }
    #chat-messages { flex-grow: 1; overflow-y: auto; padding: 1rem; border-radius: 12px; background: rgba(255 255 255 / 0.1); color: var(--text-dark); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 1rem; margin-bottom: 0.6rem; }
    body[data-theme='light'] #chat-messages { background: rgba(0 0 0 / 0.04); color: var(--text-light); }
    .chat-message { margin-bottom: 1rem; }
    .chat-message.user { text-align: right; }
    .chat-message.user .msg-text { display: inline-block; background: #e91e63; color: white; padding: 0.4rem 0.8rem; border-radius: 12px 12px 0 12px; max-width: 70%; word-wrap: break-word; }
    .chat-message.ai .msg-text { display: inline-block; background: rgba(173, 26, 114, 0.8); color: white; padding: 0.4rem 0.8rem; border-radius: 12px 12px 12px 0; max-width: 70%; word-wrap: break-word; }
    #chat-input-container { display: flex; gap: 0.5rem; }
    #chat-input { flex-grow: 1; font-size: 1rem; padding: 0.5rem 0.7rem; border-radius: 12px; border: 1px solid var(--outline-dark); background-color: var(--input-bg-dark); color: var(--text-dark); }
    body[data-theme='light'] #chat-input { border-color: var(--outline-light); background-color: var(--input-bg-light); color: var(--text-light); }
    #chat-input:focus { outline: none; border-color: #ad1a72; }
    #chat-send-btn { background: #ad1a72; border: none; border-radius: 12px; color: white; font-weight: 700; cursor: pointer; padding: 0 1.2rem; }
    #chat-send-btn:hover { background: #6f1351; }
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #ad1a72; border-radius: 8px; }
  </style>
</head>
<body data-theme="dark">
  <header>
    <h1 contenteditable="true" id="app-title" aria-label="App Title">üéÄ Countdown & Timers üéÄ</h1>
    <button id="theme-toggle" aria-label="Toggle Dark/Light Theme" title="Toggle Dark/Light Theme">
      <i id="icon-sun" class="fas fa-sun"></i>
      <i id="icon-moon" class="fas fa-moon"></i>
    </button>
  </header>
  <nav id="tabs" role="tablist" aria-label="Main Sections">
    <button role="tab" id="tab-todo" aria-controls="panel-todo" aria-selected="true">üìù To-Do</button>
    <button role="tab" id="tab-countdown" aria-controls="panel-countdown" aria-selected="false">‚è≥ Countdown</button>
    <button role="tab" id="tab-timers" aria-controls="panel-timers" aria-selected="false">‚è≤Ô∏è Timers</button>
    <button role="tab" id="tab-stopwatch" aria-controls="panel-stopwatch" aria-selected="false">‚è±Ô∏è Stopwatch</button>
    <button role="tab" id="tab-pomodoro" aria-controls="panel-pomodoro" aria-selected="false">üçÖ Pomodoro</button>
    <button role="tab" id="tab-settings" aria-controls="panel-settings" aria-selected="false">‚öôÔ∏è Settings</button>
    <button role="tab" id="tab-chat" aria-controls="panel-chat" aria-selected="false">ü§ñ Chat AI</button>
  </nav>
  <main>
    <!-- To-Do Tab -->
    <section role="tabpanel" id="panel-todo" tabindex="0" class="active" aria-labelledby="tab-todo">
      <ul id="todo-list" aria-live="polite" aria-label="To-do list"></ul>
      <div id="todo-input-container">
        <button id="todo-toggle-subtask" aria-label="Toggle subtask mode" title="Toggle subtask mode" aria-pressed="false">
          <i class="far fa-heart"></i>
        </button>
        <input type="text" id="todo-input" placeholder="Type a task and press Enter" aria-label="Task input" autocomplete="off" />
      </div>
      <button id="todo-clear" class="reset-btn" aria-label="Clear all tasks">Clear All Tasks</button>
    </section>
    <!-- Countdown Tab -->
    <section role="tabpanel" id="panel-countdown" tabindex="0" aria-labelledby="tab-countdown">
      <div class="blurred-outline">
        <label for="countdown-title-input" style="font-weight:700; color: var(--title-dark)">Countdown Title:</label>
        <input type="text" id="countdown-title-input" placeholder="üéÄ Countdown üéÄ" />
      </div>
      <div id="countdown-list" class="countdown-list" aria-live="polite"></div>
      <button id="countdown-add" class="reset-btn" aria-label="Add new countdown">Add Countdown</button>
      <button id="countdown-clear" class="reset-btn" aria-label="Clear all countdowns">Clear All Countdowns</button>
    </section>
    <!-- Timers Tab -->
    <section role="tabpanel" id="panel-timers" tabindex="0" aria-labelledby="tab-timers">
      <div class="blurred-outline">
        <label for="timers-title-input" style="font-weight:700; color: var(--title-dark)">Timers Title:</label>
        <input type="text" id="timers-title-input" placeholder="‚è≤Ô∏è Timers" />
      </div>
      <div id="timer-list" class="timer-list" aria-live="polite"></div>
      <button id="timer-add" class="reset-btn" aria-label="Add new timer">Add Timer</button>
      <button id="timer-clear" class="reset-btn" aria-label="Clear all timers">Clear All Timers</button>
    </section>
    <!-- Stopwatch Tab -->
    <section role="tabpanel" id="panel-stopwatch" tabindex="0" aria-labelledby="tab-stopwatch">
      <div id="stopwatch-display" aria-live="polite" aria-atomic="true">00:00:00.00</div>
      <div id="stopwatch-controls">
        <button id="stopwatch-start">Start</button>
        <button id="stopwatch-pause">Pause</button>
        <button id="stopwatch-reset">Reset</button>
        <button id="stopwatch-punch">Punch</button>
      </div>
      <ul id="punches-list" aria-live="polite" aria-label="Stopwatch punches"></ul>
    </section>
    <!-- Pomodoro Tab -->
    <section role="tabpanel" id="panel-pomodoro" tabindex="0" aria-labelledby="tab-pomodoro">
      <div id="pomodoro-display" aria-live="polite" aria-atomic="true">25:00</div>
      <div id="pomodoro-controls">
        <button id="pomodoro-start" aria-label="Start Pomodoro Timer"><i class="fas fa-play"></i></button>
        <button id="pomodoro-pause" aria-label="Pause Pomodoro Timer"><i class="fas fa-pause"></i></button>
        <button id="pomodoro-reset" aria-label="Reset Pomodoro Timer"><i class="fas fa-redo"></i></button>
      </div>
    </section>
    <!-- Settings Tab -->
    <section role="tabpanel" id="panel-settings" tabindex="0" aria-labelledby="tab-settings">
      <form id="settings-form" autocomplete="off" novalidate>
        <label for="input-bg-image">Background Image URL or Upload</label>
        <input type="text" id="input-bg-image" placeholder="Paste image URL here" />
        <input type="file" id="upload-bg-image" accept="image/*" aria-label="Upload background image" />
        <button type="button" id="bg-reposition-btn">Reposition Background</button>
        <div id="bg-reposition-container" hidden>
          <img id="bg-reposition-image" alt="Background to reposition" />
          <div id="bg-reposition-controls">
            <button type="button" id="bg-reposition-confirm">Confirm</button>
            <button type="button" id="bg-reposition-cancel">Cancel</button>
          </div>
        </div>
        <label for="color-text">Text Color (Hex or use color picker)</label>
        <input type="color" id="color-text" value="#FCF1F6" />
        <input type="text" id="hex-text" value="#FCF1F6" />
        <label for="color-title">Title Color</label>
        <input type="color" id="color-title" value="#AD1A72" />
        <input type="text" id="hex-title" value="#AD1A72" />
        <label for="color-outline">Outline Color</label>
        <input type="color" id="color-outline" value="#1a1a1a" />
        <input type="text" id="hex-outline" value="#1a1a1a" />
        <label for="color-input-bg">Input Background Color</label>
        <input type="color" id="color-input-bg" value="#222222" />
        <input type="text" id="hex-input-bg" value="#222222" />
        <label for="color-bg">Page Background Color</label>
        <input type="color" id="color-bg" value="#1a1a1a" />
        <input type="text" id="hex-bg" value="#1a1a1a" />
        <label for="alarm-upload">Upload Alarm Sound</label>
        <input type="file" id="alarm-upload" accept="audio/*" aria-label="Upload alarm sound" />
        <button type="button" id="alarm-reset">Reset Alarms to Default</button>
        <button type="submit" id="save-settings">Save Settings</button>
      </form>
    </section>
    <!-- Chat AI Tab -->
    <section role="tabpanel" id="panel-chat" tabindex="0" aria-labelledby="tab-chat">
      <div id="chat-container">
        <div id="chat-messages" role="log" aria-live="polite"></div>
        <div id="chat-input-container">
          <input type="text" id="chat-input" placeholder="Ask me anything..." aria-label="Chat input" autocomplete="off" />
          <button id="chat-send-btn" aria-label="Send chat message">Send</button>
        </div>
      </div>
    </section>
  </main>
  <script>
    // Your entire JavaScript logic goes here (unchanged from your previous file)
    // For brevity, you can copy the script block from your previous file.
    // If you want the full script pasted here, let me know!
  </script>
</body>
</html>
